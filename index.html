<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ナンバリング重複チェック</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .group { margin-bottom: 10px; }
    input[type="text"] { width: 300px; margin-right: 10px; }
    input[type="number"] { width: 80px; }
    .result { margin-top: 20px; }
    .error { color: red; }
  </style>
</head>
<body>

  <h1>ナンバリングチェックツール</h1>

  <div id="inputContainer">
    <!-- グループごとの入力欄がここに追加される -->
  </div>

  <button id="addRowBtn">＋行を追加</button>
  <button id="checkBtn">チェックする</button>

  <div id="resultArea" class="result"></div>

  <script>
    // ステップ 1: 初期行を1つ追加
    const container = document.getElementById("inputContainer");
    document.getElementById("addRowBtn").addEventListener("click", addRow);
    function addRow() {
      const div = document.createElement("div");
      div.className = "group";
      div.innerHTML = `
        <input type="text" placeholder="例: 1-4,6-8" class="rangeInput">
        <input type="number" placeholder="冊数" class="countInput">
      `;
      container.appendChild(div);
    }
    addRow(); // 最初の行

    // ステップ 2: チェックボタン処理
    document.getElementById("checkBtn").addEventListener("click", async () => {
      const inputs = Array.from(document.querySelectorAll(".group"));
      const payload = inputs.map(group => ({
        range: group.querySelector(".rangeInput").value,
        expectedCount: Number(group.querySelector(".countInput").value)
      }));

      try {
        const res = await fetch("/api/checkNumbers.js", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ groups: payload })
        });
        const data = await res.json();
        document.getElementById("resultArea").innerHTML = data.message.replace(/\n/g, "<br>");
      } catch (err) {
        console.error("通信エラー:", err);
        document.getElementById("resultArea").innerHTML = `<span class="error">エラーが発生しました</span>`;
      }
    });
  </script>
</body>
</html>
